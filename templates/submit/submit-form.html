<!DOCTYPE html>
<html>
<body>
  <h1>Submit Your Directory</h1>

  <form action="/submit" method="POST">
    <input name="name" placeholder="Name" required>
    <input name="url" placeholder="URL" required>
    <textarea name="description" placeholder="Description"></textarea>

    <select name="category_id">
      {{ range .Categories }}
        <option value="{{ .ID }}">{{ .Name }}</option>
      {{ end }}
    </select>

    <input name="tags" placeholder="Tags (comma-separated)">
    <input name="pricing_model" placeholder="Pricing Model">
    <input name="price_start" placeholder="Starting Price">

    <label><input type="checkbox" name="has_newsletter"> Has Newsletter</label>
    <label><input type="checkbox" name="has_blog"> Has Blog</label>

    <input type="file" id="logo-upload">
    <input type="hidden" name="logo_url" id="logo-url">
    <button onclick="uploadLogo()">Upload Logo</button>

    <script>
    async function uploadLogo() {
        const fileInput = document.getElementById("logo-upload");
        const file = fileInput.files[0];
        if (!file) return;

        const res = await fetch(`/api/upload-url?filename=logos/${file.name}`);
        const { upload_url } = await res.json();

        await fetch(upload_url, {
        method: "PUT",
        headers: {
            "Content-Type": file.type
        },
        body: file
        });

        // Save the public URL
        document.getElementById("logo-url").value = upload_url.split("?")[0];
        alert("Logo uploaded!");
    }
    </script>


    <label>Alternatives:</label>
    {{ range .Alternatives }}
      <label><input type="checkbox" name="alternatives" value="{{ .ID }}"> {{ .Name }}</label>
    {{ end }}

    <!-- Placeholder for file upload UI -->
    <p>(Image uploads coming next step)</p>

    <button type="submit">Submit and Pay</button>
  </form>

  <p>{{ .Error }}</p>
</body>
</html>
